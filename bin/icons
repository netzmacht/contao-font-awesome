#!/usr/bin/env php
<?php

require dirname(__DIR__) . '/vendor/autoload.php';

/**
 * Class IconTools
 */
class IconTools
{

    /**
     * @throws InvalidArgumentException
     */
    public function execute()
    {
        global $argv;

        $verbose = (isset($argv[1]) && $argv[1] == '-v');
        $this->updateIcons($verbose);
    }


    /**
     * @param bool $verbose
     */
    protected function updateIcons($verbose=false)
    {
        $categories = $this->loadFromYaml();

        $date   = date('d.m.Y h:i');
        $buffer = '';
        $count  = 0;

        foreach($categories as $category => $icons)
        {
            $buffer .= sprintf("\t '%s' => array (\n", $category);

            if($verbose) {
                echo $category . " (" . count($icons) . ")\n";
            }

            $count += count($icons);

            foreach($icons as $icon)
            {
                $buffer .= sprintf("\t\t'%s',\n", $icon);
            }

            $buffer .= "\t),\n\n";
        }


        echo "\n " . $count . ' Icons found.' . "\n";

        $year   = date('Y');
        $output = <<<EOF
<?php

/**
 * @package   font-awesome
 * @author    David Molineus <http://www.netzmacht.de>
 * @license   GNU/LGPL
 * @copyright Copyright 2012-{$year} netzmacht David Molineus
 *
 */

// Auto generated icons file, generated by bin/icons
// Date: $date

return array
(
$buffer);
EOF;


        $file = fopen(dirname(__DIR__) . '/module/config/icons/icons.php', 'wb+');
        fwrite($file, $output);
        fclose($file);
    }

    protected function loadFromYaml()
    {
        $data = Spyc::YAMLLoad(dirname(__DIR__) . '/vendor/fortawesome/font-awesome/src/icons.yml');
        $categories = array();

        // transform icons in category based format
        foreach($data['icons'] as $icon)
        {
            foreach($icon['categories'] as $category)
            {
                $categories[$category][] = $icon['id'];

                if(isset($icon['aliases'])) {
                    $categories[$category] = array_merge($categories[$category], $icon['aliases']);
                }
            }
        }

        return $categories;
    }
}

$controller = new IconTools();
$controller->execute();
